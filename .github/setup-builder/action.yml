
# From iceberg-rust: https://github.com/apache/iceberg-rust/blob/main/.github/actions/setup-builder/action.yml

name: Setup Rust Builder

description: 'Setup a Rust builder for the CI'

inputs:
  rust-version:
    description: 'The version of Rust to use'

runs:
  using: "composite"
  steps:
    - name: Setup specified Rust toolchain
      shell: bash
      if: ${{ inputs.rust-version != '' }}
      env:
        RUST_VERSION: ${{ inputs.rust-version }}
      run: |
        echo "Installing ${RUST_VERSION}"
        rustup toolchain install ${RUST_VERSION}
        rustup override set ${RUST_VERSION}
        rustup component add rustfmt clippy
    - name: Setup Rust toolchain according to rust-toolchain.toml
      shell: bash
      if: ${{ inputs.rust-version == '' }}
      run: |
        echo "Installing toolchain according to rust-toolchain.toml"
        rustup show
        rustup component add rustfmt clippy
    - name: Fixup git permissions
      # https://github.com/actions/checkout/issues/766
      shell: bash
      run: git config --global --add safe.directory "$GITHUB_WORKSPACE"